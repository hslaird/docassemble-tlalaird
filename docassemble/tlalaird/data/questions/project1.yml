#ASSIGNMENT 5 SEE SYLLABUS -- https://github.com/Gauntlet173/CodingTheLaw/blob/Fall2020/syllabus.md 
#go here if you don't understand TLA 4 - https://docassemble.org/docs/logic.html#howitworks
#when you are done go to packages, ensure project1 is still tagged, save again and then "Github" it. On github you go into docassemble-tlalaird/docassemble/tlalaird/data/questions/ to check if it worked. 
#question and subquestion are more like "title" and body of a page.
#check out community.lawyer for code to copy. within docassemble documentation check out recipes
objects:
  - user: Individual
  - cohabs: DAList.using(object_type=Individual, complete_attribute="complete")
  - cohabs[i].income: Value
---
mandatory: true
code: |

  qualifies
  
---
mandatory: true
question: |
  Hello, ${ user }!
    
attachments: 
  - name: Legal Aid Memo.
    filename: dudacious_document_summary
    content: |
      Memo re: Qualification for Legal Aid.
    
      Your name is ${ user }.
      
      % if len(cohabs) > 0: 
      You said you live with ${ cohabs }.
      
      % endif
  
      % if j.income.exists:
      ${ j } made ${ j.income } last year.
      % endif
  
      The total income of cohabs is ${ currency(total_income) }.
  
      % if high_total_income:
      You are financially ineligible for legal aid.
      %elif medium_total_income:
      You are marginally financially eligible for legal aid.
      % else:
      You are financially eligible for legal aid.
      % endif

      % if qualifies:
      You qualify for Legal Aid. 
      % else:
      You do not qualify for Legal Aid.
      % endif
      
      % if appeal:
      Your legal matter is an appeal of a matter for which you received LAA assistance.
      % else:
      Your legal matter is not an appeal of a matter for which you received LAA assistance.
      % endif
      
      % if defined('lives_in_AB'):
      I asked if you live in Alberta. You said ${ lives_in_AB }.
      % else:
     
      % endif
      
      % if defined('has_lawyer'):
      I asked if you have a lawyer. You said ${ has_lawyer }.
      % else:
    
      % endif
      
      % if defined('has_acting_lawyer'):
      I asked if this lawyer is still acting for you. You said ${ has_acting_lawyer }.
      % else:
      
      % endif
      
      % if defined('can_afford_lawyer'):
      I asked if you can afford a lawyer. You said ${ can_afford_lawyer }.
      % else:
      
      % endif
      
      % if defined('matter_in_AB'):
      I asked if your legal matter is in Alberta. You said ${ matter_in_AB }.
      % else:
      
      % endif
      
      % if defined('matter_is_family'):
      I asked if your matter is a family law matter. You said ${ matter_is_family }.
      % else:
      
      % endif
      
      % if defined('matter_is_criminal'):
      I asked if your matter is a criminal law matter. You said ${ matter_is_criminal }.
      % else:
     
      % endif
      
      Your signature ${ user.signature }
      
      Signed on ${ format_date(sig_date, format='EEEE, MMMM d, yyyy') } (${ format_date(sig_date, format="yyyy-MM-dd") })).
      
---
generic object: Individual
question: | 
  What is ${ x.object_possessive('name') }?
fields:
  - First Name: x.name.first
  - Last Name: x.name.last
---
code: |
  cohabs[i].income
  cohabs[i].complete = True
---
code: |
  if appeal or (lives_in_AB and matter_in_AB):
    resident = True
  else:
    resident = False
---
code: |
  if (has_lawyer and has_acting_lawyer) or can_afford_lawyer:
    unrepresented = False
  else:
    unrepresented = True
#assuming it is important to ask if you have a lawyer who is not acting for you, whether or not you can afford to hire that lawyer or a different one. 
---
code: | 
  if matter_is_criminal or matter_is_family:
    service_provided = True
  else:
    service_provided = False
---
code: |
  if income.exists and (appeal and unrepresented) or (unrepresented and resident and service_provided): 
    qualifies = True
  else:
    qualifies = False
---
code: |
  total_income = 0
  for j in cohabs: 
    if j.income.exists:
      total_income = total_income + j.income.value
---
code: |
  high_total_income = False
  medium_total_income = False
  low_total_income = False
  
  if total_income > 1000:
    high_total_income = True
  elif total_income > 800: 
    medium_total_income = True 
  else:
    low_total_income = True
---
question: What else do you know about ${ cohab[i] }?
fields:
  - Did they make income in the last year?: cohab[i].income.exists
    datatype: yesnowide
  - How much income did they make in the last year?: cohab[i].income.value
    datatype: currency
    show if: cohab[i].income.exists
---
question: Do you have a lawyer?
yesno: has_lawyer
---
question: Can you afford a lawyer?
yesno: can_afford_lawyer
---
question: Is that lawyer still acting for you?
yesno: has_acting_lawyer
---
question: Is your legal matter located in Alberta?
yesno: matter_in_AB
---
question: Do you live in Alberta?
yesno: lives_in_AB
---
question: Is your legal matter an appeal of a matter for which you received LAA assistance?
yesno: appeal
---
question: Is your legal matter a criminal law matter?
yesno: matter_is_criminal
---
question: Is your legal matter a family law matter?
yesno: matter_is_family
---
question: Do you live with anyone?
yesno: cohabs.there_are_any
---
question: Do you live with anyone else?
yesno: cohabs.there_is_another
---
question: Please sign
signature: user.signature
---
question: What is the date of signature?
fields: 
  - Signature Date: sig_date
    datatype: date